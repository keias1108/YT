<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¼ë²¨ë§ - ì‹œë‹ˆì–´ ìœ íŠœë¸Œ íŠ¸ë Œë“œ</title>
    <link rel="stylesheet" href="/static/style.css">
    <style>
        .labeling-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .video-card {
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .video-header {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .video-thumbnail-large {
            width: 240px;
            height: 135px;
            object-fit: cover;
            border-radius: 6px;
        }

        .video-info {
            flex: 1;
        }

        .video-info h3 {
            margin-bottom: 10px;
            color: #333;
        }

        .video-meta {
            color: #666;
            font-size: 0.9em;
            line-height: 1.8;
        }

        .score-display {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: bold;
            margin-left: 10px;
        }

        .highlights-display {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
        }

        .highlights-display h4 {
            margin-bottom: 10px;
            color: #667eea;
            font-size: 0.95em;
        }

        .labeling-actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .btn-label {
            flex: 1;
            padding: 15px;
            font-size: 1.1em;
            font-weight: 600;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-yes {
            background: #28a745;
            color: white;
        }

        .btn-yes:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .btn-no {
            background: #dc3545;
            color: white;
        }

        .btn-no:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .btn-skip {
            background: #6c757d;
            color: white;
            flex: 0.5;
        }

        .btn-skip:hover {
            background: #5a6268;
        }

        .progress-bar {
            margin-bottom: 30px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            text-align: center;
        }

        .progress-text {
            font-size: 1.2em;
            font-weight: 600;
            color: #667eea;
        }

        .no-videos {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .no-videos h2 {
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“ ë¹„ë””ì˜¤ ë¼ë²¨ë§</h1>
            <p class="subtitle">SeniorScoreê°€ ë†’ì€ ë¹„ë””ì˜¤ë¥¼ ê²€ìˆ˜í•˜ì—¬ ëª¨ë¸ í•™ìŠµ ë°ì´í„° ìƒì„±</p>
        </header>

        <div class="labeling-container">
            <!-- ì§„í–‰ ìƒí™© -->
            <div class="progress-bar">
                <p class="progress-text">
                    ë¼ë²¨ë§ ì™„ë£Œ: <span id="labeled-count">0</span> / ë‚¨ì€ ë¹„ë””ì˜¤: <span id="remaining-count">-</span>
                </p>
            </div>

            <!-- ë¹„ë””ì˜¤ ì¹´ë“œ -->
            <div id="video-cards-container">
                <div class="no-videos">
                    <h2>ë¡œë”© ì¤‘...</h2>
                    <p>ë¼ë²¨ë§í•  ë¹„ë””ì˜¤ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤.</p>
                </div>
            </div>

            <!-- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
            <div style="text-align: center; margin-top: 40px;">
                <a href="/" class="btn-secondary" style="display: inline-block; text-decoration: none; padding: 12px 30px;">
                    â† ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                </a>
            </div>
        </div>
    </div>

    <script>
        let unlabeledVideos = [];
        let currentIndex = 0;
        let labeledCount = 0;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            loadUnlabeledVideos();
        });

        /**
         * ë¼ë²¨ë§ ì•ˆ ëœ ë¹„ë””ì˜¤ ë¶ˆëŸ¬ì˜¤ê¸°
         */
        async function loadUnlabeledVideos() {
            try {
                const response = await fetch('/api/labels/unlabeled?limit=50');
                const result = await response.json();

                if (result.success) {
                    unlabeledVideos = result.data;
                    currentIndex = 0;

                    if (unlabeledVideos.length === 0) {
                        showNoVideos();
                    } else {
                        renderCurrentVideo();
                    }
                } else {
                    showError('ë¹„ë””ì˜¤ ë¡œë“œ ì‹¤íŒ¨: ' + result.error);
                }
            } catch (error) {
                console.error('ë¹„ë””ì˜¤ ë¡œë“œ ì‹¤íŒ¨:', error);
                showError('ë¹„ë””ì˜¤ ë¡œë“œ ì‹¤íŒ¨');
            }
        }

        /**
         * í˜„ì¬ ë¹„ë””ì˜¤ ë Œë”ë§
         */
        function renderCurrentVideo() {
            if (currentIndex >= unlabeledVideos.length) {
                showNoVideos('ëª¨ë“  ë¹„ë””ì˜¤ ë¼ë²¨ë§ ì™„ë£Œ!');
                return;
            }

            const video = unlabeledVideos[currentIndex];
            const highlights = typeof video.highlights === 'string'
                ? JSON.parse(video.highlights)
                : video.highlights;

            const container = document.getElementById('video-cards-container');
            container.innerHTML = `
                <div class="video-card">
                    <div class="video-header">
                        <img src="${video.thumbnail_url}" alt="ì¸ë„¤ì¼" class="video-thumbnail-large">
                        <div class="video-info">
                            <h3>
                                <a href="https://www.youtube.com/watch?v=${video.video_id}" target="_blank">
                                    ${video.title}
                                </a>
                            </h3>
                            <div class="video-meta">
                                <p>ì±„ë„: ${video.channel_title}</p>
                                <p>
                                    SeniorScore: <span class="score-display">${(video.senior_score || 0).toFixed(1)}</span>
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="highlights-display">
                        <h4>ê·¼ê±° (Highlights):</h4>
                        <p>
                            ${renderHighlights(highlights)}
                        </p>
                    </div>

                    <div class="labeling-actions">
                        <button class="btn-label btn-yes" onclick="saveLabel('${video.video_id}', true)">
                            âœ… ì‹œë‹ˆì–´ ì½˜í…ì¸  ë§ìŒ
                        </button>
                        <button class="btn-label btn-no" onclick="saveLabel('${video.video_id}', false)">
                            âŒ ì‹œë‹ˆì–´ ì½˜í…ì¸  ì•„ë‹˜
                        </button>
                        <button class="btn-label btn-skip" onclick="skipVideo()">
                            â­ï¸ ìŠ¤í‚µ
                        </button>
                    </div>
                </div>
            `;

            // ì§„í–‰ ìƒí™© ì—…ë°ì´íŠ¸
            document.getElementById('labeled-count').textContent = labeledCount;
            document.getElementById('remaining-count').textContent = unlabeledVideos.length - currentIndex;
        }

        /**
         * ë¼ë²¨ ì €ì¥
         */
        async function saveLabel(videoId, isSeniorContent) {
            try {
                const response = await fetch('/api/label', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        video_id: videoId,
                        is_senior_content: isSeniorContent,
                        labeled_by: 'user',
                        notes: ''
                    })
                });

                const result = await response.json();

                if (result.success) {
                    labeledCount++;
                    currentIndex++;
                    renderCurrentVideo();
                } else {
                    alert('ë¼ë²¨ ì €ì¥ ì‹¤íŒ¨: ' + result.error);
                }
            } catch (error) {
                console.error('ë¼ë²¨ ì €ì¥ ì‹¤íŒ¨:', error);
                alert('ë¼ë²¨ ì €ì¥ ì‹¤íŒ¨');
            }
        }

        /**
         * ë¹„ë””ì˜¤ ìŠ¤í‚µ
         */
        function skipVideo() {
            currentIndex++;
            renderCurrentVideo();
        }

        /**
         * Highlights ë Œë”ë§
         */
        function renderHighlights(highlights) {
            const parts = [];

            if (highlights.matched_keywords && highlights.matched_keywords.length > 0) {
                parts.push(`<strong>í‚¤ì›Œë“œ:</strong> ${highlights.matched_keywords.join(', ')}`);
            }

            if (highlights.matched_genres && highlights.matched_genres.length > 0) {
                parts.push(`<strong>ì¥ë¥´:</strong> ${highlights.matched_genres.join(', ')}`);
            }

            if (highlights.comment_indicators && highlights.comment_indicators.length > 0) {
                parts.push(`<strong>ëŒ“ê¸€ ì§€í‘œ:</strong> ${highlights.comment_indicators.join(', ')}`);
            }

            if (highlights.length_category) {
                parts.push(`<strong>ê¸¸ì´:</strong> ${highlights.length_category}`);
            }

            return parts.length > 0 ? parts.join('<br>') : 'ê·¼ê±° ì—†ìŒ';
        }

        /**
         * ë¹„ë””ì˜¤ ì—†ìŒ í‘œì‹œ
         */
        function showNoVideos(message = 'ë¼ë²¨ë§í•  ë¹„ë””ì˜¤ê°€ ì—†ìŠµë‹ˆë‹¤.') {
            const container = document.getElementById('video-cards-container');
            container.innerHTML = `
                <div class="no-videos">
                    <h2>${message}</h2>
                    <p>ë¨¼ì € ë©”ì¸ í˜ì´ì§€ì—ì„œ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ì„¸ìš”.</p>
                </div>
            `;
        }

        /**
         * ì—ëŸ¬ í‘œì‹œ
         */
        function showError(message) {
            const container = document.getElementById('video-cards-container');
            container.innerHTML = `
                <div class="no-videos">
                    <h2>ì˜¤ë¥˜ ë°œìƒ</h2>
                    <p>${message}</p>
                </div>
            `;
        }
    </script>
</body>
</html>

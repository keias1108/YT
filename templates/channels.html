<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì±„ë„ ê´€ë¦¬ - ì‹œë‹ˆì–´ ìœ íŠœë¸Œ íŠ¸ë Œë“œ</title>
    <link rel="stylesheet" href="/static/style.css" />
    <style>
      .channel-card {
        background: white;
        border: 2px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 15px;
        transition: all 0.2s;
      }

      .channel-card:hover {
        border-color: #667eea;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
      }

      .channel-info {
        flex: 1;
      }

      .channel-title {
        font-size: 1.2em;
        font-weight: 600;
        color: #333;
        margin-bottom: 5px;
      }

      .channel-meta {
        color: #666;
        font-size: 0.9em;
      }

      .btn-delete {
        padding: 8px 16px;
        background: #dc3545;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s;
      }

      .btn-delete:hover {
        background: #c82333;
      }

      .add-channel-form {
        background: #f8f9fa;
        padding: 25px;
        border-radius: 8px;
        margin-bottom: 30px;
      }

      .input-group {
        display: flex;
        gap: 10px;
        margin-top: 15px;
      }

      .input-group input {
        flex: 1;
        padding: 12px;
        border: 2px solid #ddd;
        border-radius: 6px;
        font-size: 1em;
      }

      .input-group input:focus {
        outline: none;
        border-color: #667eea;
      }

      .btn-add {
        padding: 12px 30px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s;
      }

      .btn-add:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
      }

      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #999;
      }

      .collect-section {
        background: #f8f9fa;
        padding: 25px;
        border-radius: 8px;
        margin-top: 30px;
      }

      .collect-options {
        display: flex;
        gap: 20px;
        margin-top: 15px;
        flex-wrap: wrap;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>ğŸ“º ì‹œë‹ˆì–´ ì±„ë„ ê´€ë¦¬</h1>
        <p class="subtitle">
          ìœ íŠœë¸Œ ì±„ë„ì„ ë“±ë¡í•˜ê³  ìµœì‹  ì˜ìƒì„ ìë™ìœ¼ë¡œ ìˆ˜ì§‘í•˜ì„¸ìš”
        </p>
      </header>

      <!-- ì±„ë„ ì¶”ê°€ í¼ -->
      <section class="add-channel-form">
        <h2>â• ìƒˆ ì±„ë„ ì¶”ê°€</h2>
        <div
          style="
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 15px;
          "
        >
          <strong>ğŸ’¡ ì±„ë„ ID ë˜ëŠ” URL ì…ë ¥ ë°©ë²•:</strong>
          <ol style="margin: 10px 0 0 20px; line-height: 1.8">
            <li>
              <strong>ì±„ë„ ID ì§ì ‘ ì…ë ¥</strong>:
              <code>UCxxxxxxxxxxxxx</code> (UCë¡œ ì‹œì‘)
            </li>
            <li>
              <strong>ì±„ë„ URL</strong>:
              <code>https://www.youtube.com/channel/UCxxxxx</code>
            </li>
          </ol>
          <p style="margin-top: 10px; color: #856404">
            âš ï¸ <code>@í•¸ë“¤</code> í˜•ì‹ì€ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì±„ë„ í˜ì´ì§€ â†’ ìš°í´ë¦­
            â†’ "ì±„ë„ ID ë³µì‚¬"ë¥¼ ì´ìš©í•˜ì„¸ìš”.
          </p>
        </div>
        <div class="input-group">
          <input
            type="text"
            id="channel-url"
            placeholder="UCxxxxx ë˜ëŠ” https://www.youtube.com/channel/UCxxxxx"
            value=""
          />
          <button id="btn-add-channel" class="btn-add">ì¶”ê°€</button>
        </div>
        <div
          id="add-status"
          class="status-message"
          style="margin-top: 15px"
        ></div>
      </section>

      <!-- ë“±ë¡ëœ ì±„ë„ ëª©ë¡ -->
      <section>
        <h2>ğŸ“‹ ë“±ë¡ëœ ì±„ë„ (<span id="channel-count">0</span>ê°œ)</h2>
        <div id="channels-container">
          <div class="empty-state">
            <h3>ë“±ë¡ëœ ì±„ë„ì´ ì—†ìŠµë‹ˆë‹¤</h3>
            <p>ìœ„ í¼ì—ì„œ ì‹œë‹ˆì–´ ì¹œí™” ì±„ë„ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”</p>
          </div>
        </div>
      </section>

      <!-- ìˆ˜ì§‘ ì„¤ì • -->
      <section class="collect-section">
        <h2>ğŸš€ ì±„ë„ë³„ ì˜ìƒ ìˆ˜ì§‘</h2>
        <div class="collect-options">
          <div class="form-group">
            <label>ì±„ë„ë‹¹ ìˆ˜ì§‘ ìˆ˜:</label>
            <input
              type="number"
              id="max-results-channel"
              value="50"
              min="1"
              max="50"
            />
          </div>
          <div class="form-group">
            <label>ìµœê·¼ Nì¼ ì´ë‚´:</label>
            <input type="number" id="days" value="7" min="1" max="30" />
          </div>
          <div
            class="form-group"
            style="display: flex; align-items: center; gap: 8px"
          >
            <input
              type="checkbox"
              id="skip-today-collected"
              checked
              style="width: auto; cursor: pointer"
            />
            <label
              for="skip-today-collected"
              style="cursor: pointer; margin: 0"
            >
              ì˜¤ëŠ˜ ì´ë¯¸ ìˆ˜ì§‘í•œ ì±„ë„ ê±´ë„ˆë›°ê¸° (ì¿¼í„° ì ˆì•½)
            </label>
          </div>
        </div>
        <div style="margin-top: 20px">
          <button
            id="btn-collect-channels"
            class="btn-primary"
            style="font-size: 1.1em; padding: 15px 40px"
          >
            ğŸ“Š ìˆ˜ì§‘ ì‹œì‘ (ì¿¼í„°: ~ì±„ë„ìˆ˜Ã—2)
          </button>
        </div>
        <div
          id="collect-channel-status"
          class="status-message"
          style="margin-top: 15px"
        ></div>
      </section>

      <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
      <footer>
        <p>
          <a href="/">â† ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a> |
          <a href="/labeling">ë¼ë²¨ë§ í˜ì´ì§€</a>
        </p>
      </footer>
    </div>

    <script>
      let channels = [];

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
      document.addEventListener("DOMContentLoaded", () => {
        loadChannels();

        document
          .getElementById("btn-add-channel")
          .addEventListener("click", addChannel);
        document
          .getElementById("btn-collect-channels")
          .addEventListener("click", collectFromChannels);

        // Enter í‚¤ë¡œ ì±„ë„ ì¶”ê°€
        document
          .getElementById("channel-url")
          .addEventListener("keypress", (e) => {
            if (e.key === "Enter") {
              addChannel();
            }
          });
      });

      /**
       * ì±„ë„ ëª©ë¡ ë¡œë“œ
       */
      async function loadChannels() {
        try {
          const response = await fetch("/api/channels");
          const result = await response.json();

          if (result.success) {
            channels = result.data;
            renderChannels();
          } else {
            showError("ì±„ë„ ë¡œë“œ ì‹¤íŒ¨: " + result.error);
          }
        } catch (error) {
          console.error("ì±„ë„ ë¡œë“œ ì‹¤íŒ¨:", error);
          showError("ì±„ë„ ë¡œë“œ ì‹¤íŒ¨");
        }
      }

      /**
       * ì±„ë„ ëª©ë¡ ë Œë”ë§
       */
      function renderChannels() {
        const container = document.getElementById("channels-container");
        const countEl = document.getElementById("channel-count");

        countEl.textContent = channels.length;

        if (channels.length === 0) {
          container.innerHTML = `
                    <div class="empty-state">
                        <h3>ë“±ë¡ëœ ì±„ë„ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p>ìœ„ í¼ì—ì„œ ì‹œë‹ˆì–´ ì¹œí™” ì±„ë„ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”</p>
                    </div>
                `;
          return;
        }

        container.innerHTML = channels
          .map(
            (channel) => `
                <div class="channel-card">
                    <div class="channel-info">
                        <div class="channel-title">${
                          channel.channel_title
                        }</div>
                        <div class="channel-meta">
                            êµ¬ë…ì: ${(
                              channel.subscriber_count || 0
                            ).toLocaleString()}ëª… |
                            ì±„ë„ ID: ${channel.channel_id}
                        </div>
                    </div>
                    <button class="btn-delete" onclick="deleteChannel('${
                      channel.channel_id
                    }')">
                        ì‚­ì œ
                    </button>
                </div>
            `
          )
          .join("");
      }

      /**
       * ì±„ë„ ì¶”ê°€
       */
      async function addChannel() {
        const btn = document.getElementById("btn-add-channel");
        const statusDiv = document.getElementById("add-status");
        const urlInput = document.getElementById("channel-url");
        const url = urlInput.value.trim();

        if (!url) {
          showStatus(statusDiv, "ì±„ë„ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.", "error");
          return;
        }

        btn.disabled = true;
        btn.textContent = "ì¶”ê°€ ì¤‘...";
        showStatus(statusDiv, "ì±„ë„ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...", "info");

        try {
          const response = await fetch("/api/channels/add", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ url }),
          });

          const result = await response.json();

          if (result.success) {
            showStatus(
              statusDiv,
              `âœ… ${result.data.channel_title} ì¶”ê°€ ì™„ë£Œ!`,
              "success"
            );
            urlInput.value = "";
            loadChannels();
          } else {
            showStatus(statusDiv, `âŒ ${result.error}`, "error");
          }
        } catch (error) {
          console.error("ì±„ë„ ì¶”ê°€ ì‹¤íŒ¨:", error);
          showStatus(statusDiv, `âŒ ì±„ë„ ì¶”ê°€ ì‹¤íŒ¨: ${error.message}`, "error");
        } finally {
          btn.disabled = false;
          btn.textContent = "ì¶”ê°€";
        }
      }

      /**
       * ì±„ë„ ì‚­ì œ
       */
      async function deleteChannel(channelId) {
        if (!confirm("ì •ë§ ì´ ì±„ë„ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
          return;
        }

        try {
          const response = await fetch(`/api/channels/${channelId}`, {
            method: "DELETE",
          });

          const result = await response.json();

          if (result.success) {
            alert("ì±„ë„ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
            loadChannels();
          } else {
            alert("ì‚­ì œ ì‹¤íŒ¨: " + result.error);
          }
        } catch (error) {
          console.error("ì±„ë„ ì‚­ì œ ì‹¤íŒ¨:", error);
          alert("ì±„ë„ ì‚­ì œ ì‹¤íŒ¨");
        }
      }

      /**
       * ì±„ë„ë³„ ì˜ìƒ ìˆ˜ì§‘
       */
      async function collectFromChannels() {
        const btn = document.getElementById("btn-collect-channels");
        const statusDiv = document.getElementById("collect-channel-status");

        if (channels.length === 0) {
          showStatus(
            statusDiv,
            "ë“±ë¡ëœ ì±„ë„ì´ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ì±„ë„ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”.",
            "error"
          );
          return;
        }

        const maxResults = parseInt(
          document.getElementById("max-results-channel").value
        );
        const days = parseInt(document.getElementById("days").value);
        const skipTodayCollected = document.getElementById(
          "skip-today-collected"
        ).checked;

        btn.disabled = true;
        btn.textContent = "ìˆ˜ì§‘ ì¤‘...";
        showStatus(
          statusDiv,
          `${channels.length}ê°œ ì±„ë„ì˜ ìµœê·¼ ${days}ì¼ ì˜ìƒ ìˆ˜ì§‘ ì‹œì‘...`,
          "info"
        );

        try {
          const response = await fetch("/api/channels/collect", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              max_results: maxResults,
              days: days,
              skip_today_collected: skipTodayCollected,
            }),
          });

          const result = await response.json();

          if (result.success) {
            const stats = result.data;
            let statusMsg = `âœ… ìˆ˜ì§‘ ì™„ë£Œ: ì´ ${stats.total_videos}ê°œ ì¤‘ ì‹ ê·œ ${stats.new_videos}ê°œ, ì¤‘ë³µ ìŠ¤í‚µ ${stats.duplicate_skipped}ê°œ`;
            if (stats.channels_skipped > 0) {
              statusMsg += `, ì˜¤ëŠ˜ ìˆ˜ì§‘ì™„ë£Œ ì±„ë„ ìŠ¤í‚µ ${stats.channels_skipped}ê°œ`;
            }
            showStatus(statusDiv, statusMsg, "success");
          } else {
            showStatus(statusDiv, `âŒ ì˜¤ë¥˜: ${result.error}`, "error");
          }
        } catch (error) {
          console.error("ìˆ˜ì§‘ ì‹¤íŒ¨:", error);
          showStatus(statusDiv, `âŒ ìˆ˜ì§‘ ì‹¤íŒ¨: ${error.message}`, "error");
        } finally {
          btn.disabled = false;
          btn.textContent = "ğŸ“Š ìˆ˜ì§‘ ì‹œì‘ (ì¿¼í„°: ~ì±„ë„ìˆ˜Ã—2)";
        }
      }

      /**
       * ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ
       */
      function showStatus(element, message, type) {
        element.textContent = message;
        element.className = `status-message ${type}`;
        element.style.display = "block";
      }

      /**
       * ì—ëŸ¬ í‘œì‹œ
       */
      function showError(message) {
        const container = document.getElementById("channels-container");
        container.innerHTML = `
                <div class="empty-state">
                    <h3>ì˜¤ë¥˜ ë°œìƒ</h3>
                    <p>${message}</p>
                </div>
            `;
      }
    </script>
  </body>
</html>
